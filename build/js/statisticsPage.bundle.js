(()=>{"use strict";let e=[],t=null,o=null,n=[],l=[],a=null,s=null,r=[],c=[],i=null,u=[],d=document.querySelector(".main-date__value"),m=(new Date).getFullYear()+"-"+("0"+(+(new Date).getMonth()+1)).slice(-2);var p;localStorage.getItem("currentDate")||localStorage.setItem("currentDate",m),d.textContent=(p=localStorage.getItem("currentDate"))?"Все время"==p?p:7==p.length?new Date(p).toLocaleString("default",{month:"long"})+" "+new Date(p).getFullYear():4==p.length?p:void 0:(new Date).toLocaleString("default",{month:"long"})+" "+(new Date).getFullYear();let h=localStorage.getItem("email").replace(".","*");var f=am5.Root.new("trend-chart");f.setThemes([am5themes_Animated.new(f)]);var g=f.container.children.push(am5xy.XYChart.new(f,{panX:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,paddingLeft:0,layout:f.verticalLayout}));g.set("cursor",am5xy.XYCursor.new(f,{behavior:"none"})).lineY.set("visible",!1),g.zoomOutButton.set("forceHidden",!0);var _=am5xy.AxisRendererX.new(f,{pan:"zoom",minGridDistance:10}),v=g.xAxes.push(am5xy.CategoryAxis.new(f,{maxDeviation:.1,categoryField:"date",start:.5,minZoomCount:1,maxZoomCount:6,renderer:_}));v.get("renderer").labels.template.setAll({oversizedBehavior:"wrap",textAlign:"center"}),_.labels.template.setAll({fontSize:"0.8em"});var y=g.yAxes.push(am5xy.ValueAxis.new(f,{renderer:am5xy.AxisRendererY.new(f,{strokeOpacity:.1})})),w=g.series.push(am5xy.ColumnSeries.new(f,{name:"месяцы",xAxis:v,yAxis:y,valueYField:"cost",categoryXField:"date",fill:"green"}));function x(e,t,o,n){var l,a,s=function(e){const t=e.reduce(((e,t)=>{const o=t.date;return e[o]||(e[o]={}),e[o].cost?e[o].cost+=t.cost:e[o].cost=t.cost,e[o].date=t.date,e}),{});return Object.values(t)}(function(e){const t=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"];return e.map((e=>{const o=e.date.split("-"),n=t[parseInt(o[1])-1],l=o[0];return{...e,date:`${n}, ${l}`}}))}(function(e,t){return e.sort(((e,t)=>new Date(e.date)-new Date(t.date)))}(e)));u=function(e){let t=[];for(let o of e)o.cost>=0?t.push({...o,bg:{fill:"#31a51f"},bulletLocation:{centerY:am5.p100}}):t.push({...o,bg:{fill:"red"},bulletLocation:{centerY:am5.p0}});return t}((l=function(){const e=new Date,t=e.getMonth(),o=e.getFullYear();let n=[];for(let e=0;e<12;e++){let l=t-e,a=o;l<0&&(l+=12,a-=1);const s=new Date(a,l,1).toLocaleString("ru",{month:"long"});n.push(`${s}, ${a}`)}return n.map((e=>({cost:0,date:e})))}(),a=s,l.concat(a).reduce(((e,t)=>{const o=e.findIndex((e=>e.date===t.date));return-1===o?e.push(t):e[o].cost+=t.cost,e}),[]).reverse())),t.data.setAll(u),o.data.setAll(u),o.appear(),n.appear(1e3,100)}function b(e){return fetch(`https://database-fc7b1-default-rtdb.europe-west1.firebasedatabase.app/users/${h}/${e}.json`)}function S(e){let t=[];for(let o of e)t.push({...o,cost:Math.abs(o.cost)});return t}function D(){let e=document.querySelector(".select-time").querySelector(".select__input-hidden").value,t=u.slice(u.length-+e),o=function(e){let t=e.reduce(((e,t)=>e+t.cost),0);return`${Math.floor(t/e.length)}`}(t),n=(c=t)[0].cost<0?Math.abs(Math.floor((c[c.length-1].cost-c[0].cost)/c[0].cost*100))+"%":Math.floor((c[c.length-1].cost-c[0].cost)/c[0].cost*100)+"%",l=function(e){if(e[0].cost<0){let t=(e[e.length-1].cost-e[0].cost)/e[0].cost*100;return Math.abs(Math.floor(t/e.length))+"%"}let t=(e[e.length-1].cost-e[0].cost)/e[0].cost*100;return Math.floor(t/e.length)+"%"}(t),a=document.querySelector(".trend-card__value_average"),s=document.querySelector(".trend-card__value_whole-difference"),r=document.querySelector(".trend-card__value_month-difference");var c;function i(e,t){"Infinity%"==e||"-Infinity%"==e?(t.textContent="Н/д",t.style.color="black"):(e.includes("-")&&(t.style.color="red"),e.includes("-")||(t.style.color="#31a51f"),t.textContent=e)}i(o,a),i(n,s),i(l,r)}w.columns.template.setAll({tooltipText:"{categoryX}: {valueY}",width:am5.percent(90),tooltipY:0,strokeOpacity:0}),w.columns.template.setAll({templateField:"bg"}),w.bullets.push((function(){return am5.Bullet.new(f,{locationY:1,sprite:am5.Label.new(f,{text:"{valueY}",templateField:"bulletLocation",fill:"black",centerX:am5.percent(50),populateText:!0})})})),Promise.all([b("categoriesExpenses"),b("categoriesExpensesByDate"),b("categoriesIncome"),b("categoriesIncomeByDate"),b("operationsExpenses"),b("operationsExpensesByDate"),b("operationsIncome"),b("operationsIncomeByDate")]).then((e=>Promise.all([e[0].json(),e[1].json(),e[2].json(),e[3].json(),e[4].json(),e[5].json(),e[6].json(),e[7].json()]))).then((u=>{n=u[0],t=u[1],r=u[2],a=u[3],e=u[4],o=null!=u[5]?u[5]:[],l=u[6],s=null!=u[7]?u[7]:[],c=e.concat(l),i=n.concat(r),x(S(e),v,w,g),D()})),document.querySelectorAll(".select").forEach((function(t){const o=t.querySelector(".select__button"),n=t.querySelector(".select__dropdown"),a=t.querySelector(".select__dropdown-list"),s=t.querySelectorAll(".select__dropdown-item"),r=t.querySelector(".select__input-hidden");o.addEventListener("click",(function(){a.classList.toggle("select__dropdown-list_visible"),n.classList.toggle("select__dropdown_visible"),this.classList.add("select__button_active")})),s.forEach((t=>{t.addEventListener("click",(function(s){s.stopPropagation(),o.querySelector(".select__button-title").textContent=this.textContent,r.value=this.dataset.value,a.classList.remove("select__dropdown-list_visible"),n.classList.remove("select__dropdown_visible"),t.closest(".select-trend")&&("expenses"==r.value?x(S(e),v,w,g):"income"==r.value?x(l,v,w,g):"netIncome"==r.value&&x(c,v,w,g)),D()}))})),document.addEventListener("click",(function(e){e.target!=o&&(a.classList.remove("select__dropdown-list_visible"),n.classList.remove("select__dropdown_visible"))}))}))})();