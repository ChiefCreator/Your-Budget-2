(()=>{let e=[],t=null,n=null,o=[],a=[],s=null,l=null,r=[],c=[],i=null,u=document.querySelector(".main-date__value"),d=(new Date).getFullYear()+"-"+("0"+(+(new Date).getMonth()+1)).slice(-2);var p;localStorage.getItem("currentDate")||localStorage.setItem("currentDate",d),u.textContent=(p=localStorage.getItem("currentDate"))?"Все время"==p?p:7==p.length?new Date(p).toLocaleString("default",{month:"long"})+" "+new Date(p).getFullYear():4==p.length?p:void 0:(new Date).toLocaleString("default",{month:"long"})+" "+(new Date).getFullYear();let m=localStorage.getItem("email").replace(".","*");var g=am5.Root.new("trend-chart");g.setThemes([am5themes_Animated.new(g)]);var v=g.container.children.push(am5xy.XYChart.new(g,{panX:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0,paddingLeft:0,layout:g.verticalLayout}));v.set("cursor",am5xy.XYCursor.new(g,{behavior:"none"})).lineY.set("visible",!1),v.zoomOutButton.set("forceHidden",!0);var h=am5xy.AxisRendererX.new(g,{pan:"zoom",minGridDistance:10}),w=v.xAxes.push(am5xy.CategoryAxis.new(g,{maxDeviation:.1,categoryField:"date",start:.5,minZoomCount:1,maxZoomCount:6,renderer:h}));w.get("renderer").labels.template.setAll({oversizedBehavior:"wrap",textAlign:"center"}),h.labels.template.setAll({fontSize:"0.8em"});var _=v.yAxes.push(am5xy.ValueAxis.new(g,{renderer:am5xy.AxisRendererY.new(g,{strokeOpacity:.1})})),x=v.series.push(am5xy.ColumnSeries.new(g,{name:"месяцы",xAxis:w,yAxis:_,valueYField:"cost",categoryXField:"date",fill:"green"}));function f(e){return fetch(`https://database-fc7b1-default-rtdb.europe-west1.firebasedatabase.app/users/${m}/${e}.json`)}function y(e,t){return"decrease"==t?e.sort(((e,t)=>new Date(t.date)-new Date(e.date))):"increase"==t?e.sort(((e,t)=>new Date(e.date)-new Date(t.date))):void 0}function b(e){const t=e.reduce(((e,t)=>{const n=t.date;return e[n]||(e[n]={}),e[n].cost?e[n].cost+=t.cost:e[n].cost=t.cost,e[n].date=t.date,e}),{});return Object.values(t)}function D(e){const t=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"];return e.map((e=>{const n=e.date.split("-"),o=t[parseInt(n[1])-1],a=n[0];return{...e,date:`${o}, ${a}`}}))}function A(){const e=new Date,t=e.getMonth(),n=e.getFullYear();let o=[];for(let e=0;e<12;e++){let a=t-e,s=n;a<0&&(a+=12,s-=1);const l=new Date(s,a,1).toLocaleString("ru",{month:"long"});o.push(`${l}, ${s}`)}return o.map((e=>({cost:0,date:e})))}function S(e,t){return e.concat(t).reduce(((e,t)=>{const n=e.findIndex((e=>e.date===t.date));return-1===n?e.push(t):e[n].cost+=t.cost,e}),[]).reverse()}function L(e){let t=[];for(let n of e)t.push({...n,cost:Math.abs(n.cost)});return t}x.columns.template.setAll({tooltipText:"{categoryX}: {valueY}",width:am5.percent(90),tooltipY:0,strokeOpacity:0}),x.bullets.push((function(){return am5.Bullet.new(g,{locationY:1,sprite:am5.Label.new(g,{text:"{valueY}",fill:"black",centerY:30,centerX:am5.percent(50),populateText:!0})})})),Promise.all([f("categoriesExpenses"),f("categoriesExpensesByDate"),f("categoriesIncome"),f("categoriesIncomeByDate"),f("operationsExpenses"),f("operationsExpensesByDate"),f("operationsIncome"),f("operationsIncomeByDate")]).then((e=>Promise.all([e[0].json(),e[1].json(),e[2].json(),e[3].json(),e[4].json(),e[5].json(),e[6].json(),e[7].json()]))).then((u=>{o=u[0],t=u[1],r=u[2],s=u[3],e=u[4],n=null!=u[5]?u[5]:[],a=u[6],l=null!=u[7]?u[7]:[],c=e.concat(a),i=o.concat(r),u=b(D(y(L(e),"increase"))),console.log(S(A(),u)),w.data.setAll(S(A(),u)),x.data.setAll(S(A(),u)),x.appear(),v.appear(1e3,100)})),document.querySelectorAll(".select").forEach((function(t){const n=t.querySelector(".select__button"),o=t.querySelector(".select__dropdown"),s=t.querySelector(".select__dropdown-list"),l=t.querySelectorAll(".select__dropdown-item"),r=t.querySelector(".select__input-hidden");function i(e,t,n,o){var a=b(D(y(e,"increase")));t.data.setAll(S(A(),a)),n.data.setAll(S(A(),a)),n.appear(),o.appear(1e3,100)}n.addEventListener("click",(function(){s.classList.toggle("select__dropdown-list_visible"),o.classList.toggle("select__dropdown_visible"),this.classList.add("select__button_active")})),l.forEach((t=>{t.addEventListener("click",(function(t){t.stopPropagation(),n.querySelector(".select__button-title").textContent=this.textContent,r.value=this.dataset.value,"expenses"==r.value?i(L(e),w,x,v):"income"==r.value?i(a,w,x,v):"netIncome"==r.value&&i(c,w,x,v),s.classList.remove("select__dropdown-list_visible"),o.classList.remove("select__dropdown_visible")}))})),document.addEventListener("click",(function(e){e.target!=n&&(s.classList.remove("select__dropdown-list_visible"),o.classList.remove("select__dropdown_visible"))}))}))})();